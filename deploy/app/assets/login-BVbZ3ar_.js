const __vite__fileDeps=["assets/auth-utils-C932B-PK.js","assets/index-DCzl8a2M.js","assets/index-BDXx1mQP.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{o as v,s as u,r as S,u as L,a as _,b as I,c as E,t as F,j as e,C as A,L as g,I as h,B as P,d as T,e as c,_ as D}from"./index-DCzl8a2M.js";const k=v({email:u().email("البريد الإلكتروني غير صالح"),password:u().min(6,"كلمة المرور يجب أن تكون 6 أحرف على الأقل")});function B(){const[r,m]=S.useState(!1),{toast:i}=L();_();const{login:x}=I(),{register:d,handleSubmit:w,formState:{errors:s},setError:l}=E({resolver:F(k),defaultValues:{email:"",password:""}}),j=async o=>{var n,b;m(!0);try{if(console.log("Login form submission for:",o.email),console.log("Supabase available:",!!c),c){console.log("Attempting direct Supabase login");try{const{data:a,error:f}=await c.auth.signInWithPassword({email:o.email,password:o.password});if(f)console.error("Direct Supabase login error:",f),console.log("Falling back to useAuth login method");else if(a.user){console.log("Direct Supabase login successful",a.user);const{ensureUserInPublicTable:N}=await D(async()=>{const{ensureUserInPublicTable:y}=await import("./auth-utils-C932B-PK.js");return{ensureUserInPublicTable:y}},__vite__mapDeps([0,1,2])),t=await N(a.user);t?localStorage.setItem("auth_user",JSON.stringify({id:t.id,email:t.email,role:t.role,name:t.name,avatar:t.avatar,permissions:t.permissions})):localStorage.setItem("auth_user",JSON.stringify({id:a.user.id,email:a.user.email,name:((n=a.user.user_metadata)==null?void 0:n.name)||a.user.email.split("@")[0],role:((b=a.user.user_metadata)==null?void 0:b.role)||"viewer"})),i({title:"تم تسجيل الدخول بنجاح",description:"مرحباً بك في نظام إدارة الرواتب"}),window.location.href="/";return}}catch(a){console.error("Exception during direct Supabase login:",a),console.log("Falling back to useAuth login method")}}console.log("Using useAuth login method"),await x(o.email,o.password)?(i({title:"تم تسجيل الدخول بنجاح",description:"مرحباً بك في نظام إدارة الرواتب"}),window.location.href="/"):l("root",{message:"البريد الإلكتروني أو كلمة المرور غير صحيحة"})}catch(p){console.error("Login error:",p),l("root",{message:"حدث خطأ أثناء تسجيل الدخول"})}finally{m(!1)}};return e.jsx("div",{className:"flex justify-center items-center min-h-screen bg-gradient-to-b from-primary/5 to-muted/20 tempo-634c9792-e2b7-5732-98fe-c52688c8c7fb",dir:"rtl",tempoelementid:"tempo-634c9792-e2b7-5732-98fe-c52688c8c7fb",children:e.jsxs(A,{className:"w-full max-w-md p-8 shadow-lg border-t-4 border-t-primary animate-fadeIn tempo-7bcb0f65-233b-5822-bf26-a0ce5ece1b64",tempoelementid:"tempo-7bcb0f65-233b-5822-bf26-a0ce5ece1b64",children:[e.jsxs("div",{className:"text-center mb-8 animate-fadeIn tempo-15faefec-79d6-53c1-ab2a-6859ea6cf7f7",tempoelementid:"tempo-15faefec-79d6-53c1-ab2a-6859ea6cf7f7",children:[e.jsx("img",{src:"https://api.dicebear.com/7.x/initials/svg?seed=B&backgroundColor=0891b2",alt:"Logo",className:"h-20 w-20 mx-auto mb-4 rounded-xl shadow-md transition-transform hover:scale-105 duration-300 tempo-7257a14b-c343-5e0e-8d3a-3b4444ac93e7",tempoelementid:"tempo-7257a14b-c343-5e0e-8d3a-3b4444ac93e7"},"263298935982443464804484689412077979082-4"),e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-l from-primary to-primary/70 bg-clip-text text-transparent tempo-741e1612-6ca2-5119-a99c-7dfd664c9075",tempoelementid:"tempo-741e1612-6ca2-5119-a99c-7dfd664c9075",children:"نظام إدارة الرواتب"},"263298935982443464804484689412077979082-5"),e.jsx("p",{className:"text-muted-foreground mt-2 tempo-fd3a0f81-276a-5e09-afde-ab061f35e959",tempoelementid:"tempo-fd3a0f81-276a-5e09-afde-ab061f35e959",children:"تسجيل الدخول للوصول إلى لوحة التحكم"},"263298935982443464804484689412077979082-6")]},"263298935982443464804484689412077979082-3"),e.jsxs("form",{onSubmit:w(j),className:"space-y-4 tempo-7660d482-8391-52c4-af30-21aed80f4725",tempoelementid:"tempo-7660d482-8391-52c4-af30-21aed80f4725",children:[e.jsxs("div",{className:"space-y-2 tempo-bc52f71b-981e-5774-bcc6-e8a8e9be0624",tempoelementid:"tempo-bc52f71b-981e-5774-bcc6-e8a8e9be0624",children:[e.jsx(g,{htmlFor:"email",className:"tempo-d956af87-341e-5c2f-b599-c70b6d876ce4 ",tempoelementid:"tempo-d956af87-341e-5c2f-b599-c70b6d876ce4",children:"البريد الإلكتروني"}),e.jsx(h,{id:"email",type:"email",placeholder:"admin@example.com",...d("email"),className:"text-right tempo-cb157cb3-1018-5f3b-906c-cbe5a1705907",dir:"ltr",tempoelementid:"tempo-cb157cb3-1018-5f3b-906c-cbe5a1705907"}),s.email&&e.jsx("p",{className:"text-sm text-red-500 tempo-afc1f25b-74c5-5535-a546-7d93f363d462",tempoelementid:"tempo-afc1f25b-74c5-5535-a546-7d93f363d462",children:s.email.message},"263298935982443464804484689412077979082-11")]},"263298935982443464804484689412077979082-8"),e.jsxs("div",{className:"space-y-2 tempo-5220cc82-a4b7-5dad-be35-de0706cde6ac",tempoelementid:"tempo-5220cc82-a4b7-5dad-be35-de0706cde6ac",children:[e.jsx(g,{htmlFor:"password",className:"tempo-828d3c9a-4371-59b7-9e18-41e631d76b43 ",tempoelementid:"tempo-828d3c9a-4371-59b7-9e18-41e631d76b43",children:"كلمة المرور"}),e.jsx(h,{id:"password",type:"password",placeholder:"******",...d("password"),className:"text-right tempo-b67c6b70-b170-56c6-a30b-44c7fa93a6eb",dir:"ltr",tempoelementid:"tempo-b67c6b70-b170-56c6-a30b-44c7fa93a6eb"}),s.password&&e.jsx("p",{className:"text-sm text-red-500 tempo-b1386474-a866-5565-a9da-2823dca96bfb",tempoelementid:"tempo-b1386474-a866-5565-a9da-2823dca96bfb",children:s.password.message},"263298935982443464804484689412077979082-15")]},"263298935982443464804484689412077979082-12"),s.root&&e.jsx("div",{className:"p-3 bg-red-50 text-red-600 rounded-md text-sm tempo-2c9a9ca4-86d0-5352-a660-411ad208ce26",tempoelementid:"tempo-2c9a9ca4-86d0-5352-a660-411ad208ce26",children:s.root.message},"263298935982443464804484689412077979082-16"),e.jsx(P,{type:"submit",className:"w-full transition-all duration-300 hover:shadow-md tempo-aac4f4b1-9b43-5b37-a5f2-1f69e8d1e11d",disabled:r,tempoelementid:"tempo-aac4f4b1-9b43-5b37-a5f2-1f69e8d1e11d",children:r?e.jsxs(e.Fragment,{children:[e.jsx(T,{size:"sm",className:"ml-2 tempo-d195a76e-8cc0-583c-9c6d-5e6533ad7afa",tempoelementid:"tempo-d195a76e-8cc0-583c-9c6d-5e6533ad7afa"}),"جاري تسجيل الدخول..."]}):"تسجيل الدخول"})]},"263298935982443464804484689412077979082-7")]})},"263298935982443464804484689412077979082-1")}function O(){return e.jsx(B,{className:"tempo-0f9db88a-8b6f-5163-87d4-64126124dcd8 ",tempoelementid:"tempo-0f9db88a-8b6f-5163-87d4-64126124dcd8"})}export{O as default};
